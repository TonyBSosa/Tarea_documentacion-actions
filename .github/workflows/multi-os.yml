name: Tests Multi-OS

# Este workflow demuestra c√≥mo ejecutar tests en m√∫ltiples sistemas operativos
on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  # Job con matrix strategy para ejecutar en m√∫ltiples SO y versiones de Node
  test-matrix:
    name: Test en ${{ matrix.os }} con Node ${{ matrix.node-version }}
    runs-on: ${{ matrix.os }}
    
    strategy:
      # No detener todos los jobs si uno falla
      fail-fast: false
      matrix:
        # Matriz de sistemas operativos
        os: [ubuntu-latest, windows-latest, macos-latest]
        # Matriz de versiones de Node.js
        node-version: [16, 18, 20]
    
    steps:
      - name: üì• Checkout del c√≥digo
        uses: actions/checkout@v3
      
      - name: ‚öôÔ∏è Configurar Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}
      
      - name: üì¶ Instalar dependencias
        run: npm install
      
      - name: üß™ Ejecutar tests
        run: npm test
      
      # Informaci√≥n general del runner
      - name: üíª Informaci√≥n general del Sistema Operativo
        run: |
          echo "===================================="
          echo "Sistema (matrix): ${{ matrix.os }}"
          echo "Node.js (matrix): ${{ matrix.node-version }}"
          echo "Runner OS real:   $RUNNER_OS"
          echo "===================================="

      # Info espec√≠fica seg√∫n el SO
      - name: üêß Info Linux
        if: runner.os == 'Linux'
        run: |
          echo "Ejecutando en Linux"
          uname -a
          cat /etc/os-release
          echo "===================================="

      - name: ü™ü Info Windows
        if: runner.os == 'Windows'
        shell: pwsh
        run: |
          Write-Host "Ejecutando en Windows"
          Write-Host "===================================="
          Write-Host "Informaci√≥n del sistema:"
          systeminfo | findstr /C:"OS"
          Write-Host "===================================="

      - name: üçè Info macOS
        if: runner.os == 'macOS'
        run: |
          echo "Ejecutando en macOS"
          sw_vers
          echo "===================================="

  # Job que solo se ejecuta en Linux para comparar
  linux-specific:
    name: üêß Operaciones espec√≠ficas de Linux
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v3
      
      - name: üêß Comandos espec√≠ficos de Linux
        run: |
          echo "Estos comandos solo funcionan en Linux:"
          echo "===================================="
          echo "Distribuci√≥n:"
          cat /etc/os-release
          echo "===================================="
          echo "Kernel:"
          uname -r
          echo "===================================="
          echo "CPU Info:"
          lscpu | grep "Model name"
          echo "===================================="
          echo "Memoria:"
          free -h
          echo "===================================="
          echo "Procesos del sistema:"
          ps aux | head -n 10

  # Job que solo se ejecuta en Windows
  windows-specific:
    name: ü™ü Operaciones espec√≠ficas de Windows
    runs-on: windows-latest
    
    steps:
      - name: üì• Checkout
        uses: actions/checkout@v3
      
      - name: ü™ü Comandos espec√≠ficos de Windows
        shell: pwsh
        run: |
          Write-Host "Estos comandos solo funcionan en Windows:"
          Write-Host "===================================="
          Write-Host "Informaci√≥n del Sistema:"
          Get-ComputerInfo | Select-Object CsName, WindowsVersion, OsArchitecture
          Write-Host "===================================="
          Write-Host "Procesos en ejecuci√≥n:"
          Get-Process | Select-Object -First 10 Name, CPU, Id
          Write-Host "===================================="

  # Job que resume los resultados
  summary:
    name: üìä Resumen de Ejecuci√≥n
    needs: [test-matrix, linux-specific, windows-specific]
    runs-on: ubuntu-latest
    if: always()  # Se ejecuta incluso si alg√∫n job falla
    
    steps:
      - name: üìä Generar resumen
        run: |
          echo "===================================="
          echo "RESUMEN DE EJECUCI√ìN MULTI-OS"
          echo "===================================="
          echo "‚úÖ Todos los jobs completados"
          echo "Los tests se ejecutaron en:"
          echo "  - Ubuntu (Linux)"
          echo "  - Windows"
          echo "  - macOS"
          echo "Con Node.js versiones: 16, 18, 20"
          echo "===================================="
          echo "Total de combinaciones: 9 (3 OS x 3 versiones)"
          echo "===================================="
